<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Shop | The Motunde Brand</title>
    <link rel="icon" type="image/png" href="https://i.imgur.com/CVKXV7R.png">
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        brandBlack: '#000000',
                        brandPink: '#F7C8D0',
                        brandPinkDark: '#E2A9B3',
                    },
                    letterSpacing: { luxury: '0.4em', refined: '0.15em' }
                }
            }
        }
    </script>
    <style>
        html { scroll-behavior: smooth; }
        ::-webkit-scrollbar { height: 3px; }
        ::-webkit-scrollbar-track { background: transparent; }
        ::-webkit-scrollbar-thumb { background: #F7C8D0; }

        /* Hero Slider Styles */
        .slide-fade { transition: opacity 1.2s ease-in-out; position: absolute; inset: 0; width: 100%; height: 100%; }
        .slide-hidden { opacity: 0; pointer-events: none; }
        .slide-active { opacity: 1; pointer-events: auto; }
        .glass-overlay { background: rgba(0, 0, 0, 0.4); backdrop-filter: blur(8px); border: 1px solid rgba(247, 200, 208, 0.1); }

        /* Sidebar Styles */
        #sidebar { transition: transform 0.4s cubic-bezier(0.4, 0, 0.2, 1); }
        .sidebar-open { transform: translateX(0); }
        .sidebar-closed { transform: translateX(-100%); }

        /* Modal Animation */
        #product-modal { transition: opacity 0.3s ease-out; }
        .modal-content { transition: transform 0.3s ease-out; }

        /* Collection Grid */
        .collection-grid {
            display: grid;
            grid-auto-flow: column;
            grid-auto-columns: 48%;
            gap: 1rem;
            overflow-x: auto;
            scroll-snap-type: x mandatory;
            scrollbar-width: none;
            padding-bottom: 1rem;
        }
        .collection-grid::-webkit-scrollbar { display: none; }
        
        @media (min-width: 768px) {
            .collection-grid { grid-auto-columns: calc(20% - 1rem); }
        }

        .product-card { scroll-snap-align: start; transition: all 0.4s ease; border: 1px solid #f3f4f6; }
        .product-card:hover { border-color: #F7C8D0; transform: translateY(-2px); }
        
        .size-select { 
            appearance: none; 
            background-image: url("data:image/svg+xml;charset=UTF-8,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='black' stroke-width='2'%3e%3cpolyline points='6 9 12 15 18 9'%3e%3c/polyline%3e%3c/svg%3e"); 
            background-repeat: no-repeat; 
            background-position: right 0.5rem center; 
            background-size: 0.6em; 
        }
    </style>
</head>
<body class="bg-white font-sans antialiased overflow-x-hidden">

    <nav class="fixed w-full z-[100] bg-brandBlack px-4 md:px-8 py-4 flex justify-between items-center shadow-lg">
        <div class="flex items-center gap-4">
            <button onclick="toggleSidebar(true)" class="md:hidden text-brandPink">
                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path d="M4 8h16M4 16h16" stroke-width="2"></path></svg>
            </button>
            <h1 class="text-brandPink text-xs md:text-lg font-black tracking-luxury uppercase">The Motunde Brand</h1>
        </div>

        <div class="hidden md:flex space-x-8 text-[10px] tracking-widest uppercase text-brandPink/70">
            <a href="index.html" class="hover:text-brandPink transition">Home</a>
            <a href="#women" class="hover:text-brandPink transition">Women</a>
            <a href="#men" class="hover:text-brandPink transition">Men</a>
            <a href="#kids" class="hover:text-brandPink transition">Kids</a>
        </div>

        <div class="flex items-center gap-5 text-brandPink">
            <a href="account.html" class="hover:text-white transition">
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z" stroke-width="1.5"></path></svg>
            </a>
            <button onclick="openCart()" class="relative hover:text-white transition">
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path d="M16 11V7a4 4 0 00-8 0v4M5 9h14l1 12H4L5 9z" stroke-width="1.5"></path></svg>
                <span id="cart-count" class="absolute -top-2 -right-2 bg-white text-brandBlack text-[9px] font-bold w-4 h-4 rounded-full flex items-center justify-center">0</span>
            </button>
        </div>
    </nav>

    <div id="sidebar-overlay" onclick="toggleSidebar(false)" class="fixed inset-0 bg-black/60 z-[110] hidden backdrop-blur-sm"></div>
    
    <aside id="sidebar" class="fixed top-0 left-0 h-full w-64 bg-brandBlack z-[120] sidebar-closed p-6 flex flex-col">
        <button onclick="toggleSidebar(false)" class="self-end text-brandPink mb-10">
            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path d="M6 18L18 6M6 6l12 12" stroke-width="2"></path></svg>
        </button>
        <div class="flex flex-col space-y-6 text-[10px] tracking-[0.25em] uppercase text-brandPink/80">
            <a href="index.html" onclick="toggleSidebar(false)" class="hover:text-brandPink transition-colors">Home</a>
            <a href="#women" onclick="toggleSidebar(false)" class="hover:text-brandPink transition-colors">Women</a>
            <a href="#men" onclick="toggleSidebar(false)" class="hover:text-brandPink transition-colors">Men</a>
            <a href="#kids" onclick="toggleSidebar(false)" class="hover:text-brandPink transition-colors">Kids</a>
            <div class="pt-6 border-t border-brandPink/10 mt-4">
                <a href="account.html" class="text-[9px] tracking-widest opacity-50 hover:opacity-100 transition-opacity">My Account</a>
            </div>
        </div>
    </aside>

    <section class="pt-16 bg-brandBlack relative">
        <div class="relative h-[300px] md:h-[450px] overflow-hidden">
            <div id="slide-group-1" class="slide-fade slide-active flex flex-row h-full">
                <div class="w-full md:w-1/2 h-full"><img src="https://i.imgur.com/Wp0HCu8.jpeg" class="w-full h-full object-cover"></div>
                <div class="hidden md:block md:w-1/2 h-full"><img src="https://i.imgur.com/Wp0HCu8.jpeg" class="w-full h-full object-cover"></div>
            </div>
            <div id="slide-group-2" class="slide-fade slide-hidden flex flex-row h-full">
                <div class="w-full md:w-1/2 h-full"><img src="https://i.imgur.com/mfXDwZG.jpeg" class="w-full h-full object-cover"></div>
                <div class="hidden md:block md:w-1/2 h-full"><img src="https://i.imgur.com/BRl8AVs.jpeg" class="w-full h-full object-cover"></div>
            </div>
        </div>

        <div class="absolute inset-0 flex flex-col items-center justify-center z-10 pointer-events-none">
            <div class="glass-overlay p-6 md:p-10 rounded-full border border-brandPink/20 pointer-events-auto relative group">
                <button id="shop-dropdown-btn" class="text-brandPink uppercase tracking-[0.5em] text-[10px] md:text-xs font-bold flex items-center gap-4">
                    Quick Access
                    <svg class="w-3 h-3 transition-transform group-hover:rotate-180" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path d="M19 9l-7 7-7-7" stroke-width="2"></path></svg>
                </button>
                <div id="shop-dropdown-menu" class="absolute top-full left-1/2 -translate-x-1/2 mt-4 w-64 bg-brandBlack/95 backdrop-blur-xl border border-brandPink/20 opacity-0 invisible transition-all duration-300 transform -translate-y-2">
                    <div class="flex flex-col py-4">
                        <a href="#women" class="px-6 py-3 text-[9px] text-brandPink/80 hover:text-brandPink uppercase tracking-widest transition">Women's Collection</a>
                        <a href="#men" class="px-6 py-3 text-[9px] text-brandPink/80 hover:text-brandPink uppercase tracking-widest transition">Men's Collection</a>
                        <a href="#kids" class="px-6 py-3 text-[9px] text-brandPink/80 hover:text-brandPink uppercase tracking-widest transition">Kids' Collection</a>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <main class="py-20">
        <section id="women" class="mb-24 px-4 md:px-12 relative">
            <div class="flex justify-between items-end mb-8">
                <div>
                    <h2 class="text-brandBlack text-lg md:text-xl font-light uppercase tracking-[0.3em]">Women's Collection</h2>
                    <div class="w-12 h-[1px] bg-brandPink mt-2"></div>
                </div>
                <a href="womenscollection.html" class="text-[9px] uppercase tracking-widest text-brandPinkDark flex items-center gap-2 font-bold">
                    View All <svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path d="M17 8l4 4m0 0l-4 4m4-4H3" stroke-width="2"/></svg>
                </a>
            </div>
            <div id="women-grid" class="collection-grid"></div>
        </section>

        <section id="men" class="mb-24 px-4 md:px-12 relative">
            <div class="flex justify-between items-end mb-8">
                <div>
                    <h2 class="text-brandBlack text-lg md:text-xl font-light uppercase tracking-[0.3em]">Men's Collection</h2>
                    <div class="w-12 h-[1px] bg-brandPink mt-2"></div>
                </div>
                <a href="menscollection.html" class="text-[9px] uppercase tracking-widest text-brandPinkDark flex items-center gap-2 font-bold">
                    View All <svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path d="M17 8l4 4m0 0l-4 4m4-4H3" stroke-width="2"/></svg>
                </a>
            </div>
            <div id="men-grid" class="collection-grid"></div>
        </section>

        <section id="kids" class="mb-20 px-4 md:px-12 relative">
            <div class="flex justify-between items-end mb-8">
                <div>
                    <h2 class="text-brandBlack text-lg md:text-xl font-light uppercase tracking-[0.3em]">Kids Collection</h2>
                    <div class="w-12 h-[1px] bg-brandPink mt-2"></div>
                </div>
                <a href="kidscollection.html" class="text-[9px] uppercase tracking-widest text-brandPinkDark flex items-center gap-2 font-bold">
                    View All <svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path d="M17 8l4 4m0 0l-4 4m4-4H3" stroke-width="2"/></svg>
                </a>
            </div>
            <div id="kids-grid" class="collection-grid"></div>
        </section>
    </main>

    <div id="product-modal" class="fixed inset-0 z-[200] flex items-center justify-center p-4 bg-black/90 opacity-0 invisible pointer-events-none">
        <div class="modal-content bg-white w-full max-w-4xl relative flex flex-col md:flex-row scale-95 shadow-2xl">
            <button onclick="closeModal()" class="absolute top-4 right-4 z-10 text-brandBlack hover:text-brandPink">
                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path d="M6 18L18 6M6 6l12 12" stroke-width="2"/></svg>
            </button>
            <div class="w-full md:w-1/2 bg-gray-100 aspect-square">
                <img id="modal-img" src="" class="w-full h-full object-cover">
            </div>
            <div class="w-full md:w-1/2 p-8 md:p-12 flex flex-col justify-center">
                <p id="modal-cat" class="text-[10px] uppercase tracking-widest text-brandPinkDark mb-2">Collection</p>
                <h2 id="modal-name" class="text-2xl font-light uppercase tracking-[0.2em] mb-4">Product Name</h2>
                <p id="modal-price" class="text-xl font-medium mb-8">₦0</p>
                
                <div class="mb-8">
                    <label class="block text-[10px] uppercase tracking-widest mb-3">Select Size</label>
                    <div id="modal-sizes" class="flex flex-wrap gap-2">
                        </div>
                </div>

                <button id="modal-add-btn" class="w-full bg-brandBlack text-brandPink py-4 uppercase tracking-[0.3em] text-xs hover:bg-brandPink hover:text-brandBlack transition-all">Add to Bag</button>
            </div>
        </div>
    </div>

    <script>
        let currentProducts = [];

        // Sidebar logic
        function toggleSidebar(open) {
            const sidebar = document.getElementById('sidebar');
            const overlay = document.getElementById('sidebar-overlay');
            if (open) {
                sidebar.classList.replace('sidebar-closed', 'sidebar-open');
                overlay.classList.remove('hidden');
            } else {
                sidebar.classList.replace('sidebar-open', 'sidebar-closed');
                overlay.classList.add('hidden');
            }
        }

        // Modal Logic
        function openModal(productId) {
            const p = currentProducts.find(prod => prod._id === productId);
            if (!p) return;

            document.getElementById('modal-img').src = p.imageUrl;
            document.getElementById('modal-name').innerText = p.name;
            document.getElementById('modal-cat').innerText = p.category + " Collection";
            
            const variants = p.variants || [{size: 'Default', price: p.price || 0}];
            document.getElementById('modal-price').innerText = `₦${Number(variants[0].price).toLocaleString()}`;
            
            const sizeContainer = document.getElementById('modal-sizes');
            sizeContainer.innerHTML = variants.map((v, i) => `
                <button onclick="updateModalPrice('${v.price}', this)" class="size-btn px-4 py-2 border ${i===0?'border-brandPink bg-brandPink/5':'border-gray-200'} text-[10px] uppercase transition-all">
                    ${v.size}
                </button>
            `).join('');

            document.getElementById('modal-add-btn').onclick = () => {
                addToCart(p._id);
                closeModal();
            };

            const modal = document.getElementById('product-modal');
            modal.classList.remove('invisible', 'opacity-0', 'pointer-events-none');
            modal.querySelector('.modal-content').classList.remove('scale-95');
            document.body.style.overflow = 'hidden';
        }

        function closeModal() {
            const modal = document.getElementById('product-modal');
            modal.classList.add('invisible', 'opacity-0', 'pointer-events-none');
            modal.querySelector('.modal-content').classList.add('scale-95');
            document.body.style.overflow = '';
        }

        function updateModalPrice(price, btn) {
            document.getElementById('modal-price').innerText = `₦${Number(price).toLocaleString()}`;
            document.querySelectorAll('.size-btn').forEach(b => b.classList.replace('border-brandPink', 'border-gray-200'));
            btn.classList.replace('border-gray-200', 'border-brandPink');
        }

        // Hero Slider Logic
        let currentSlide = 1;
        setInterval(() => {
            const s1 = document.getElementById(`slide-group-1`);
            const s2 = document.getElementById(`slide-group-2`);
            if (currentSlide === 1) {
                s1.classList.replace('slide-active', 'slide-hidden');
                s2.classList.replace('slide-hidden', 'slide-active');
                currentSlide = 2;
            } else {
                s2.classList.replace('slide-active', 'slide-hidden');
                s1.classList.replace('slide-hidden', 'slide-active');
                currentSlide = 1;
            }
        }, 5000);

        // Shopping Bag count
        let cartItems = 0;
        function addToCart(id) { 
            cartItems++;
            document.getElementById('cart-count').innerText = cartItems;
            alert("Added to your collection."); 
        }

        // Fetch and Render
        async function loadProducts() {
            try {
                const response = await fetch('/api/products');
                currentProducts = await response.json();

                const renderCard = (p) => {
                    const variants = p.variants || [{size: 'Default', price: p.price || 0}];
                    return `
                    <div class="product-card bg-white p-3 group">
                        <div onclick="openModal('${p._id}')" class="aspect-[4/5] overflow-hidden mb-4 bg-gray-50 cursor-pointer">
                            <img src="${p.imageUrl}" class="w-full h-full object-cover transition duration-700 group-hover:scale-110">
                        </div>
                        <div class="text-center">
                            <h3 class="uppercase font-bold text-[8px] tracking-widest mb-1 truncate">${p.name}</h3>
                            <p id="price-${p._id}" class="text-brandPinkDark font-medium text-[10px] mb-3">₦${Number(variants[0].price).toLocaleString()}</p>
                            <select onchange="handleSizeChange(this, '${p._id}')" class="size-select w-full border border-gray-100 text-[8px] uppercase py-1.5 px-2 mb-2 focus:outline-none">
                                ${variants.map(v => `<option value="${v.size}" data-price="${v.price}">${v.size}</option>`).join('')}
                            </select>
                            <button onclick="addToCart('${p._id}')" class="w-full bg-brandBlack text-brandPink text-[8px] py-2.5 uppercase tracking-widest hover:bg-brandPink hover:text-brandBlack transition-all">Add to Bag</button>
                        </div>
                    </div>`;
                };

                const populateGrid = (cat, elementId) => {
                    const filtered = currentProducts.filter(p => p.category?.toLowerCase() === cat).slice(0, 5);
                    document.getElementById(elementId).innerHTML = filtered.length > 0 ? filtered.map(renderCard).join('') : `<p class="text-[10px] uppercase text-gray-400 py-10">Vault Opening Soon...</p>`;
                };

                populateGrid('women', 'women-grid');
                populateGrid('men', 'men-grid');
                populateGrid('kids', 'kids-grid');
            } catch (err) { console.error("Error:", err); }
        }

        function handleSizeChange(select, productId) {
            const price = select.options[select.selectedIndex].getAttribute('data-price');
            document.getElementById(`price-${productId}`).innerText = `₦${Number(price).toLocaleString()}`;
        }

        loadProducts();
    </script>
</body>
</html>