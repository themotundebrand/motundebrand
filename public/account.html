<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Account | The Motunde Brand</title>
    <link rel="icon" type="image/png" href="https://i.imgur.com/CVKXV7R.png">
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        brandBlack: '#000000',
                        brandPink: '#F7C8D0',
                        brandGray: '#1A1A1A',
                    },
                    letterSpacing: { luxury: '0.4em' }
                }
            }
        }
    </script>
    <style>
        input, select { 
            background: transparent !important; 
            border-bottom: 1px solid rgba(247, 200, 208, 0.3) !important; 
            transition: border-color 0.3s; 
            border-radius: 0 !important;
        }
        input:focus, select:focus { border-color: #F7C8D0 !important; outline: none; }
        .form-container { display: none; }
        .form-active { display: block; animation: fadeIn 0.5s ease-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        
        select { appearance: none; background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 24 24' stroke='%23F7C8D0'%3E%3Cpath stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M19 9l-7 7-7-7'%3E%3C/path%3E%3C/svg%3E"); background-repeat: no-repeat; background-position: right center; background-size: 12px; }
    </style>
</head>
<body class="bg-brandBlack text-white min-h-screen flex flex-col font-sans">

    <nav class="p-6">
        <a href="shop.html" class="text-brandPink text-[10px] tracking-luxury uppercase">← Back to Shop</a>
    </nav>

    <main class="flex-grow flex items-center justify-center px-6 py-12">
        <div class="w-full max-w-lg bg-brandGray/50 p-8 md:p-12 rounded-sm border border-brandPink/5 backdrop-blur-md">
            
            <div id="tab-header" class="flex justify-center space-x-8 mb-12">
                <button id="tab-login" onclick="switchTab('login')" class="text-[10px] uppercase tracking-widest text-brandPink border-b border-brandPink pb-2">Login</button>
                <button id="tab-register" onclick="switchTab('register')" class="text-[10px] uppercase tracking-widest text-brandPink/40 hover:text-brandPink pb-2 transition">Create Account</button>
            </div>

            <form id="login-form" class="form-container form-active space-y-6">
                <div>
                    <label class="block text-[8px] uppercase tracking-widest text-brandPink/60 mb-2">Email Address</label>
                    <input type="email" id="login-email" required class="w-full py-2 text-sm text-white">
                </div>
                <div>
                    <label class="block text-[8px] uppercase tracking-widest text-brandPink/60 mb-2">Password</label>
                    <input type="password" id="login-password" required class="w-full py-2 text-sm text-white">
                </div>
                <button type="submit" class="w-full bg-brandPink text-brandBlack py-4 text-[10px] font-bold uppercase tracking-[0.3em] hover:bg-white transition-all duration-500">
                    Sign In
                </button>
            </form>

            <form id="register-form" class="form-container space-y-5">
                <div>
                    <label class="block text-[8px] uppercase tracking-widest text-brandPink/60 mb-1">Full Name</label>
                    <input type="text" id="reg-name" required class="w-full py-2 text-sm text-white">
                </div>

                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div>
                        <label class="block text-[8px] uppercase tracking-widest text-brandPink/60 mb-1">Phone Number</label>
                        <input type="tel" id="reg-phone" required class="w-full py-2 text-sm text-white">
                    </div>
                    <div>
                        <label class="block text-[8px] uppercase tracking-widest text-brandPink/60 mb-1">WhatsApp Number</label>
                        <input type="tel" id="reg-whatsapp" required class="w-full py-2 text-sm text-white">
                    </div>
                </div>

                <div>
                    <label class="block text-[8px] uppercase tracking-widest text-brandPink/60 mb-1">Email Address</label>
                    <input type="email" id="reg-email" required class="w-full py-2 text-sm text-white">
                </div>

                <div class="pt-4 border-t border-brandPink/10 mt-4">
                    <p class="text-[9px] uppercase tracking-luxury text-brandPink mb-4">Shipping Details</p>
                    <div class="space-y-4">
                        <div>
                            <label class="block text-[8px] uppercase tracking-widest text-brandPink/60 mb-1">Street Address</label>
                            <input type="text" id="reg-street" placeholder="House No. and Street Name" required class="w-full py-2 text-sm text-white placeholder:text-gray-700">
                        </div>
                        <div class="grid grid-cols-2 gap-4">
                            <div>
                                <label class="block text-[8px] uppercase tracking-widest text-brandPink/60 mb-1">City</label>
                                <input type="text" id="reg-city" required class="w-full py-2 text-sm text-white">
                            </div>
                            <div>
                                <label class="block text-[8px] uppercase tracking-widest text-brandPink/60 mb-1">State</label>
                                <input type="text" id="reg-state" required class="w-full py-2 text-sm text-white">
                            </div>
                        </div>
                    </div>
                </div>

                <div class="pt-2">
                    <label class="block text-[8px] uppercase tracking-widest text-brandPink/60 mb-1">Create Password</label>
                    <input type="password" id="reg-password" required class="w-full py-2 text-sm text-white">
                </div>

                <button type="submit" class="w-full bg-brandPink text-brandBlack py-4 mt-4 text-[10px] font-bold uppercase tracking-[0.3em] hover:bg-white transition-all duration-500">
                    Create Profile
                </button>
            </form>

            <form id="verify-form" class="form-container space-y-8 text-center">
                <div>
                    <h2 class="text-brandPink text-[12px] uppercase tracking-luxury mb-2">Verify Email</h2>
                    <p class="text-[9px] text-brandPink/40 uppercase tracking-widest leading-relaxed">
                        We've sent a 6-digit code to your email.<br>Please enter it below to activate your account.
                    </p>
                </div>
                
                <div class="flex justify-center gap-2">
                    <input type="text" id="otp-code" maxlength="6" placeholder="000000" 
                           class="w-48 text-center text-2xl tracking-[0.5em] font-bold py-4 !border-b-2 !border-brandPink">
                </div>

                <button type="submit" class="w-full bg-brandPink text-brandBlack py-4 text-[10px] font-bold uppercase tracking-[0.3em] hover:bg-white transition-all duration-500">
                    Confirm Activation
                </button>
            </form>

        </div>
    </main>

    <footer class="bg-brandBlack pt-16 pb-10 px-6 md:px-12 border-t border-brandPink/5">
        <div class="max-w-7xl mx-auto mb-16 text-center">
            <p class="text-brandPink/30 text-[8px] tracking-[0.3em] uppercase">
                © 2026 The Motunde Brand. All Rights Reserved.
            </p>
        </div>
    </footer>

  <script>
    const API_URL = '/api';
    let pendingEmail = ""; 

    // --- NEW: REDIRECT IF ALREADY LOGGED IN ---
    // This runs as soon as the page loads
    window.onload = () => {
        const token = localStorage.getItem('motunde_token');
        const user = localStorage.getItem('motunde_user');
        
        if (token && user) {
            // User is already logged in, send them to membership details
            window.location.href = 'membership.html';
        }
    };

    function switchTab(tab) {
        const loginForm = document.getElementById('login-form');
        const regForm = document.getElementById('register-form');
        const verifyForm = document.getElementById('verify-form');
        const loginBtn = document.getElementById('tab-login');
        const regBtn = document.getElementById('tab-register');

        verifyForm.classList.remove('form-active');

        if(tab === 'login') {
            loginForm.classList.add('form-active');
            regForm.classList.remove('form-active');
            loginBtn.className = "text-[10px] uppercase tracking-widest text-brandPink border-b border-brandPink pb-2";
            regBtn.className = "text-[10px] uppercase tracking-widest text-brandPink/40 hover:text-brandPink pb-2 transition";
        } else {
            regForm.classList.add('form-active');
            loginForm.classList.remove('form-active');
            regBtn.className = "text-[10px] uppercase tracking-widest text-brandPink border-b border-brandPink pb-2";
            loginBtn.className = "text-[10px] uppercase tracking-widest text-brandPink/40 hover:text-brandPink pb-2 transition";
        }
    }

    // 1. REGISTER LOGIC
    document.getElementById('register-form').onsubmit = async (e) => {
        e.preventDefault();
        const submitBtn = e.target.querySelector('button');
        const originalText = submitBtn.innerText;
        submitBtn.innerText = "SENDING CODE...";
        submitBtn.disabled = true;

        pendingEmail = document.getElementById('reg-email').value;
        
        const userData = {
            name: document.getElementById('reg-name').value,
            email: pendingEmail,
            password: document.getElementById('reg-password').value,
            phone: document.getElementById('reg-phone').value,
            whatsapp: document.getElementById('reg-whatsapp').value,
            address: {
                street: document.getElementById('reg-street').value,
                city: document.getElementById('reg-city').value,
                state: document.getElementById('reg-state').value,
                country: "Nigeria"
            }
        };

        try {
            const res = await fetch(`${API_URL}/register`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(userData)
            });
            const data = await res.json();
            
            if(res.ok) {
                document.getElementById('tab-header').style.display = 'none';
                document.getElementById('register-form').classList.remove('form-active');
                document.getElementById('verify-form').classList.add('form-active');
            } else {
                alert(data.error || "Registration failed");
            }
        } catch (err) { 
            alert("Connection Error"); 
        } finally { 
            submitBtn.innerText = originalText;
            submitBtn.disabled = false;
        }
    };

    // 2. VERIFY OTP LOGIC
    document.getElementById('verify-form').onsubmit = async (e) => {
        e.preventDefault();
        const otp = document.getElementById('otp-code').value;
        const submitBtn = e.target.querySelector('button');
        submitBtn.innerText = "VERIFYING...";

        try {
            const res = await fetch(`${API_URL}/verify-otp`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ email: pendingEmail, otp })
            });
            const data = await res.json();
            
            if(data.token) {
                // Success: Redirect to SHOP
                saveSession(data.token, data.user, 'shop.html');
            } else {
                alert(data.error || "Invalid Code");
            }
        } catch (err) { 
            alert("Verification Error"); 
        } finally {
            submitBtn.innerText = "Confirm Activation";
        }
    };

    // 3. LOGIN LOGIC
    document.getElementById('login-form').onsubmit = async (e) => {
        e.preventDefault();
        const email = document.getElementById('login-email').value;
        const password = document.getElementById('login-password').value;

        try {
            const res = await fetch(`${API_URL}/login`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ email, password })
            });
            const data = await res.json();
            if(data.token) {
                // Success: Redirect to SHOP
                saveSession(data.token, data.user, 'shop.html');
            } else { 
                alert(data.error); 
            }
        } catch (err) { alert("Connection Error"); }
    };

    function saveSession(token, user, redirectTarget) {
        localStorage.setItem('motunde_token', token);
        localStorage.setItem('motunde_user', JSON.stringify(user));
        window.location.href = redirectTarget;
    }
</script>
</body>
</html>