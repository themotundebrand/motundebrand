<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Order History | The Motunde Brand</title>
    <link rel="icon" type="image/png" href="https://i.imgur.com/CVKXV7R.png">
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        brandBlack: '#000000',
                        brandPink: '#F7C8D0',
                        brandPinkDark: '#E2A9B3',
                    },
                    letterSpacing: { luxury: '0.4em', refined: '0.15em' }
                }
            }
        }
    </script>
    <style>
        /* Sidebar Transitions */
        .sidebar-closed { transform: translateX(-100%); transition: transform 0.4s cubic-bezier(0.4, 0, 0.2, 1); }
        .sidebar-open { transform: translateX(0); transition: transform 0.4s cubic-bezier(0.4, 0, 0.2, 1); }
        
        /* Card Hover Effects */
        .order-card { transition: all 0.3s ease; border: 1px solid #f9fafb; }
        .order-card:hover { border-color: #F7C8D0; box-shadow: 0 10px 30px -15px rgba(0,0,0,0.05); }

        /* Custom Scrollbar for a cleaner look */
        ::-webkit-scrollbar { width: 5px; }
        ::-webkit-scrollbar-track { background: #fff; }
        ::-webkit-scrollbar-thumb { background: #000; }
    </style>
</head>
<body class="bg-white font-sans antialiased text-brandBlack">

    <nav class="fixed w-full z-[150] bg-brandBlack px-4 md:px-8 py-5 flex justify-between items-center border-b border-brandPink/10">
        <div class="flex items-center gap-3">
            <button onclick="toggleSidebar(true)" class="md:hidden text-brandPink p-1">
                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path d="M4 8h16M4 16h16" stroke-width="2" stroke-linecap="round"></path></svg>
            </button>
            <h1 class="text-brandPink text-[10px] md:text-lg font-black tracking-luxury uppercase">The Motunde Brand</h1>
        </div>

        <div class="hidden md:flex space-x-8 text-[10px] tracking-widest uppercase text-white/90">
            <a href="index.html" class="hover:text-brandPink transition">Home</a>
            <a href="shop.html" class="hover:text-brandPink transition">Shop</a>
            <a href="membership.html" class="hover:text-brandPink transition">Profile</a>
            <a href="orderhistory.html" class="text-brandPink">Order History</a>
        </div>

        <div class="flex items-center gap-4 text-brandPink">
            <a href="membership.html" class="hover:text-white transition">
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z" stroke-width="1.5"></path></svg>
            </a>
            <a href="cart.html" class="relative hover:text-white transition">
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path d="M16 11V7a4 4 0 00-8 0v4M5 9h14l1 12H4L5 9z" stroke-width="1.5"></path></svg>
            </a>
        </div>
    </nav>

    <div id="sidebar-overlay" onclick="toggleSidebar(false)" class="fixed inset-0 bg-black/60 z-[160] hidden backdrop-blur-sm"></div>
    <aside id="sidebar" class="fixed top-0 left-0 h-full w-72 bg-brandBlack z-[170] sidebar-closed p-8 flex flex-col">
        <button onclick="toggleSidebar(false)" class="self-end text-brandPink mb-12">
            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path d="M6 18L18 6M6 6l12 12" stroke-width="2"></path></svg>
        </button>
        <div class="flex flex-col space-y-8 text-[11px] tracking-[0.3em] uppercase text-brandPink/80">
            <a href="index.html" class="hover:text-brandPink">Home</a>
            <a href="shop.html" class="hover:text-brandPink">Shop Collection</a>
            <a href="orderhistory.html" class="text-white">Order History</a>
            <hr class="border-brandPink/10">
            <a href="membership.html" class="text-[9px] opacity-60">My Profile</a>
        </div>
    </aside>

    <main class="max-w-4xl mx-auto px-4 pt-28 md:pt-36 pb-20">
        <div class="mb-10 md:mb-16 flex flex-col sm:flex-row sm:items-end justify-between gap-6">
            <div class="space-y-2">
                <h2 class="text-2xl md:text-4xl font-light uppercase tracking-luxury">Order History</h2>
                <div class="w-12 h-[1px] bg-brandPink"></div>
                <p class="text-[9px] md:text-[10px] tracking-widest text-brandPinkDark font-bold uppercase">Archived luxury acquisitions</p>
            </div>
            <a href="shop.html" class="text-[9px] font-black uppercase tracking-widest border-b border-brandBlack pb-1 w-max hover:text-brandPinkDark hover:border-brandPinkDark transition">Continue Shopping</a>
        </div>

        <div id="loading-state" class="py-20 text-center">
            <div class="inline-block w-8 h-8 border-2 border-brandPink border-t-brandBlack rounded-full animate-spin"></div>
            <p class="text-[9px] uppercase tracking-widest mt-4 text-gray-400">Consulting Archives...</p>
        </div>

        <div id="empty-state" class="hidden py-16 px-6 text-center bg-gray-50 border border-dashed border-gray-200">
            <p class="text-[10px] uppercase tracking-widest text-gray-400 mb-6">Your acquisition history is currently empty</p>
            <a href="shop.html" class="inline-block bg-brandBlack text-brandPink px-10 py-4 text-[10px] font-bold uppercase tracking-widest hover:bg-brandPink hover:text-brandBlack transition">Explore Collection</a>
        </div>

        <div id="orders-container" class="space-y-8 md:space-y-12">
            </div>
    </main>

    <script>
        function toggleSidebar(open) {
            const sidebar = document.getElementById('sidebar');
            const overlay = document.getElementById('sidebar-overlay');
            if (open) {
                sidebar.classList.replace('sidebar-closed', 'sidebar-open');
                overlay.classList.remove('hidden');
                document.body.style.overflow = 'hidden';
            } else {
                sidebar.classList.replace('sidebar-open', 'sidebar-closed');
                overlay.classList.add('hidden');
                document.body.style.overflow = 'auto';
            }
        }

        document.addEventListener('DOMContentLoaded', async () => {
            const token = localStorage.getItem('motunde_token');
            const container = document.getElementById('orders-container');
            const loading = document.getElementById('loading-state');
            const empty = document.getElementById('empty-state');

            if (!token) {
                window.location.href = 'account.html';
                return;
            }

            try {
                const response = await fetch('/api/order/my-orders', {
                    method: 'GET',
                    headers: { 
                        'Authorization': `Bearer ${token}`,
                        'Content-Type': 'application/json'
                    }
                });

                if (!response.ok) throw new Error("Fetch failed");
                const orders = await response.json();
                
                loading.classList.add('hidden');

                if (!orders || orders.length === 0) {
                    empty.classList.remove('hidden');
                    return;
                }

                container.innerHTML = orders.map(order => `
                    <div class="order-card bg-white p-5 md:p-10">
                        <div class="flex flex-col md:flex-row justify-between items-start gap-4 mb-8 pb-6 border-b border-gray-50">
                            <div class="grid grid-cols-2 md:block gap-4 w-full md:w-auto">
                                <div class="space-y-1">
                                    <p class="text-[7px] md:text-[8px] text-gray-400 uppercase tracking-widest">Order Ref</p>
                                    <h3 class="text-[11px] md:text-sm font-black tracking-widest uppercase">#TMB-${(order._id || 'N/A').slice(-6).toUpperCase()}</h3>
                                </div>
                                <div class="md:mt-4 space-y-1">
                                    <p class="text-[7px] md:text-[8px] text-gray-400 uppercase tracking-widest">Date</p>
                                    <p class="text-[10px] text-gray-500 font-medium">${new Date(order.createdAt).toLocaleDateString('en-GB', { day: '2-digit', month: 'short', year: 'numeric' })}</p>
                                </div>
                            </div>
                            
                            <div class="flex justify-between md:justify-end gap-8 md:gap-16 w-full md:w-auto border-t md:border-0 pt-4 md:pt-0">
                                <div class="space-y-1 text-left md:text-right">
                                    <p class="text-[7px] md:text-[8px] text-gray-400 uppercase tracking-widest">Status</p>
                                    <span class="block text-[9px] md:text-[10px] font-black uppercase tracking-widest text-brandPinkDark">
                                        ${order.status || 'In Review'}
                                    </span>
                                </div>
                                <div class="space-y-1 text-right">
                                    <p class="text-[7px] md:text-[8px] text-gray-400 uppercase tracking-widest">Investment</p>
                                    <p class="text-[12px] md:text-sm font-black">₦${(order.totalPrice || 0).toLocaleString()}</p>
                                </div>
                            </div>
                        </div>

                        <div class="space-y-6">
                            ${(order.items || []).map(item => `
                                <div class="flex items-center gap-4 md:gap-6 group">
                                    <div class="relative overflow-hidden bg-gray-50 w-16 h-20 md:w-20 md:h-24 flex-shrink-0">
                                        <img src="${item.image || 'https://i.imgur.com/CVKXV7R.png'}" class="w-full h-full object-cover transition duration-500 group-hover:scale-110">
                                    </div>
                                    <div class="flex-1 min-w-0">
                                        <h4 class="text-[9px] md:text-[11px] font-bold uppercase tracking-widest truncate">${item.name}</h4>
                                        <p class="text-[8px] md:text-[9px] text-gray-400 uppercase mt-1">Size: ${item.size} • Qty: ${item.quantity}</p>
                                        <p class="md:hidden text-[10px] font-bold mt-1">₦${((item.price || 0) * (item.quantity || 1)).toLocaleString()}</p>
                                    </div>
                                    <p class="hidden md:block text-[11px] font-bold">₦${((item.price || 0) * (item.quantity || 1)).toLocaleString()}</p>
                                </div>
                            `).join('')}
                        </div>

                        <div class="mt-10 flex justify-end">
                            <a href="order-confirmation.html?id=${order._id}" class="group flex items-center gap-3 text-[8px] md:text-[9px] font-black uppercase tracking-widest border border-brandBlack px-8 py-3 hover:bg-brandBlack hover:text-brandPink transition duration-300">
                                Full Breakdown
                                <svg class="w-3 h-3 transform group-hover:translate-x-1 transition-transform" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path d="M17 8l4 4m0 0l-4 4m4-4H3" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></path></svg>
                            </a>
                        </div>
                    </div>
                `).join('');

            } catch (err) {
                loading.innerHTML = `<p class="text-[9px] uppercase tracking-widest text-red-400">Communication Error. Please refresh the archive.</p>`;
            }
        });
    </script>
</body>
</html>