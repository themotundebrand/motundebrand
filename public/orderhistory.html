<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Order History | The Motunde Brand</title>
    <link rel="icon" type="image/png" href="https://i.imgur.com/CVKXV7R.png">
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        brandBlack: '#000000',
                        brandPink: '#F7C8D0',
                        brandPinkDark: '#E2A9B3',
                    },
                    letterSpacing: { luxury: '0.4em', refined: '0.15em' }
                }
            }
        }
    </script>
    <style>
        /* Essential Sidebar Transitions */
        .sidebar-closed { transform: translateX(-100%); transition: transform 0.4s cubic-bezier(0.4, 0, 0.2, 1); }
        .sidebar-open { transform: translateX(0); transition: transform 0.4s cubic-bezier(0.4, 0, 0.2, 1); }
        
        .order-card { transition: all 0.3s ease; border: 1px solid #f3f4f6; }
        .order-card:hover { border-color: #F7C8D0; transform: translateY(-2px); }
        body { background-color: #ffffff; }
    </style>
</head>
<body class="font-sans antialiased text-brandBlack">

    <nav class="fixed w-full z-[150] bg-brandBlack px-4 md:px-8 py-6 flex justify-between items-center transition-all duration-300 border-b border-brandPink/10">
        <div class="flex items-center gap-4">
            <button onclick="toggleSidebar(true)" class="md:hidden text-brandPink">
                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path d="M4 6h16M4 12h16M4 18h16" stroke-width="2" stroke-linecap="round"></path></svg>
            </button>
            <h1 class="text-brandPink text-xs md:text-lg font-black tracking-luxury uppercase">The Motunde Brand</h1>
        </div>

        <div class="hidden md:flex space-x-8 text-[10px] tracking-widest uppercase text-white/90">
            <a href="index.html" class="hover:text-brandPink transition">Home</a>
            <a href="shop.html" class="hover:text-brandPink transition">Shop</a>
            <a href="membership.html" class="hover:text-brandPink transition">Profile</a>
            <a href="orderhistory.html" class="hover:text-brandPink transition">Order History</a>
        </div>

        <div class="flex items-center gap-5 text-brandPink">
            <a href="membership.html" class="hover:text-white transition">
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z" stroke-width="1.5"></path>
                </svg>
            </a>
            <a href="cart.html" class="relative hover:text-white transition">
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path d="M16 11V7a4 4 0 00-8 0v4M5 9h14l1 12H4L5 9z" stroke-width="1.5"></path></svg>
            </a>
        </div>
    </nav>

    <div id="sidebar-overlay" onclick="toggleSidebar(false)" class="fixed inset-0 bg-black/60 z-[160] hidden backdrop-blur-sm"></div>
    
    <aside id="sidebar" class="fixed top-0 left-0 h-full w-64 bg-brandBlack z-[170] sidebar-closed p-6 flex flex-col">
        <button onclick="toggleSidebar(false)" class="self-end text-brandPink mb-10">
            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path d="M6 18L18 6M6 6l12 12" stroke-width="2"></path></svg>
        </button>
        <div class="flex flex-col space-y-6 text-[10px] tracking-[0.25em] uppercase text-brandPink/80">
            <a href="index.html" class="hover:text-brandPink transition">Home</a>
            <a href="shop.html" class="hover:text-brandPink transition">Shop Collection</a>
            <a href="orderhistory.html" class="hover:text-brandPink transition text-white">Order History</a>
            <div class="pt-6 border-t border-brandPink/10 mt-4">
                <a href="membership.html" class="text-[9px] tracking-widest opacity-50 hover:opacity-100 transition-opacity">My Account</a>
            </div>
        </div>
    </aside>

    <main class="max-w-5xl mx-auto px-6 pt-32 pb-20">
        <div class="mb-12 flex flex-col md:flex-row md:items-end justify-between gap-4">
            <div>
                <h2 class="text-2xl md:text-3xl font-light uppercase tracking-luxury">Order History</h2>
                <p class="text-[10px] tracking-widest text-brandPinkDark font-bold mt-2 uppercase">Track your luxury acquisitions</p>
            </div>
            <a href="shop.html" class="text-[9px] font-black uppercase tracking-widest border-b border-brandBlack pb-1 hover:text-brandPinkDark hover:border-brandPinkDark transition">Continue Shopping</a>
        </div>

        <div id="loading-state" class="py-20 text-center">
            <div class="inline-block w-8 h-8 border-2 border-brandPink border-t-brandBlack rounded-full animate-spin"></div>
            <p class="text-[10px] uppercase tracking-widest mt-4 text-gray-400">Retrieving Archive...</p>
        </div>

        <div id="empty-state" class="hidden py-20 text-center bg-gray-50 border border-dashed border-gray-200">
            <p class="text-[10px] uppercase tracking-widest text-gray-400 mb-6">No orders found in your history</p>
            <a href="shop.html" class="bg-brandBlack text-brandPink px-8 py-4 text-[10px] font-bold uppercase tracking-widest">Start Shopping</a>
        </div>

        <div id="orders-container" class="space-y-6"></div>
    </main>

    <script>
        // Sidebar Toggle Function
        function toggleSidebar(open) {
            const sidebar = document.getElementById('sidebar');
            const overlay = document.getElementById('sidebar-overlay');
            if (open) {
                sidebar.classList.replace('sidebar-closed', 'sidebar-open');
                overlay.classList.remove('hidden');
                document.body.style.overflow = 'hidden';
            } else {
                sidebar.classList.replace('sidebar-open', 'sidebar-closed');
                overlay.classList.add('hidden');
                document.body.style.overflow = 'auto';
            }
        }

        document.addEventListener('DOMContentLoaded', async () => {
            const token = localStorage.getItem('motunde_token');
            const container = document.getElementById('orders-container');
            const loading = document.getElementById('loading-state');
            const empty = document.getElementById('empty-state');

            if (!token) {
                window.location.href = 'account.html';
                return;
            }

            try {
                const response = await fetch('/api/order/my-orders', {
                    method: 'GET',
                    headers: { 
                        'Authorization': `Bearer ${token}`,
                        'Content-Type': 'application/json'
                    }
                });

                if (!response.ok) throw new Error("Failed to fetch");

                const orders = await response.json();
                loading.classList.add('hidden');

                if (!orders || orders.length === 0) {
                    empty.classList.remove('hidden');
                    return;
                }

                container.innerHTML = orders.map(order => `
                    <div class="order-card bg-white p-6 md:p-10">
                        <div class="flex flex-col md:flex-row justify-between gap-6 mb-8 pb-6 border-b border-gray-50">
                            <div class="space-y-1">
                                <p class="text-[8px] text-gray-400 uppercase tracking-widest">Reference</p>
                                <h3 class="text-sm font-black tracking-widest uppercase">#TMB-${(order._id || 'N/A').slice(-6).toUpperCase()}</h3>
                                <p class="text-[10px] text-gray-400">${new Date(order.createdAt).toLocaleDateString()}</p>
                            </div>
                            
                            <div class="flex gap-10">
                                <div class="space-y-1">
                                    <p class="text-[8px] text-gray-400 uppercase tracking-widest">Status</p>
                                    <span class="block text-[10px] font-bold uppercase tracking-widest text-brandPinkDark">
                                        ${order.status || 'Processing'}
                                    </span>
                                </div>
                                <div class="space-y-1">
                                    <p class="text-[8px] text-gray-400 uppercase tracking-widest">Total</p>
                                    <p class="text-sm font-black">₦${(order.totalPrice || 0).toLocaleString()}</p>
                                </div>
                            </div>
                        </div>

                        <div class="space-y-4">
                            ${(order.items || []).map(item => `
                                <div class="flex items-center gap-4">
                                    <img src="${item.image || 'https://i.imgur.com/CVKXV7R.png'}" class="w-12 h-16 object-cover bg-gray-50">
                                    <div class="flex-1">
                                        <h4 class="text-[10px] font-bold uppercase tracking-widest">${item.name}</h4>
                                        <p class="text-[9px] text-gray-400 uppercase">Size: ${item.size} | Qty: ${item.quantity}</p>
                                    </div>
                                    <p class="text-[10px] font-bold">₦${((item.price || 0) * (item.quantity || 1)).toLocaleString()}</p>
                                </div>
                            `).join('')}
                        </div>

                        <div class="mt-8 flex justify-end">
                            <a href="order-confirmation.html?id=${order._id}" class="text-[9px] font-black uppercase tracking-widest border border-brandBlack px-6 py-2 hover:bg-brandBlack hover:text-brandPink transition">
                                View Details
                            </a>
                        </div>
                    </div>
                `).join('');

            } catch (err) {
                console.error("Order history error:", err);
                loading.innerHTML = `<p class="text-[10px] uppercase tracking-widest text-red-400">Unable to load orders. Please try again later.</p>`;
            }
        });
    </script>
</body>
</html>